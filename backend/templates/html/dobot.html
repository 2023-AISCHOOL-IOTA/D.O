<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOBOT</title>
    <link rel="stylesheet" href="{{ url_for('static', path = '/chat.css')}}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
    <div class="container py-5" id = "full">
        <div class="row d-flex justify-content-center">
            <!--justify-content-center : 자식 요소들을 수평으로 중앙에 정렬-->
            <div class="col-md-10 col-lg-8 col-xl-6">
                <!--col-md-10 : 중간사이즈화면에서 10개의 컬럼을 차지하도록 지정
                    col-lg-8 : 큰 사이즈 화면에서 8개의 컬럼을 차지하도록 지정
                    col-xl-6 : 매우 큰 사이즈 화면에서 6개의 컬럼을 차지하도록 지정-->
                <div class="card" id="chat1">
                    <div class="card-header d-flex justify-content-between align-items-center p-3" style="background-color: lightgoldenrodyellow;">
                        <!--d-flex : flexbox 레이아웃을 사용하도록 지시
                            justify-content-between : 요소들 사이에 좌우로 최대한의 여백을 만들어내어 요소들을 가능한 한 화면 양쪽에 정렬
                            align-items-center : 요소들을 세로 방향으로 중앙에 정렬
                            p-3 : 상하좌우 padding=3-->
                        <div class="container">
                            <a href="home.html"><img src="{{ url_for('static', path = '/images/back.jpg')}}"alt="back" width="30px" height="30px"></a>
                            <img src="{{ url_for('static', path ='/images/good.png')}}" alt="good" width="30px" height="30px">
                            <h3 class="client"> 고객</h3>
                        </div>
                    </div>
                    <div class="card-body" data-mdb-perfect-scrollbar="true" style="position : relative;" style="background-color: white;">
                        <div class="d-flex flex-row justify-content-start">
                            <div class ="chat-container-1" class="card-body overflow-auto">
                                <div class = "row">
                                    <div class="message-container-1">
                                        <div class="bot-message">안녕하세요! 어떤 도움이 필요하세요?</div>
                                        <img src="{{ url_for('static',path = '/images/logo.png')}}" alt="manage" width="30px" height="30px">
                                    </div>
                                </div>
                                <div class = "row">
                                    <div class="message-container-2">
                                        <img src="{{ url_for('static', path ='/images/good.png')}}" alt="good" width="30px" height="30px">
                                        <div class="user-message">짬뽕을 주문하고 싶어요!</div>
                                    </div>
                                </div>
                                <div class = "row">
                                    <div class="message-container-1">
                                        <div class="bot-message">어떤 짬뽕을 먹을건가요?</div>
                                        <img src="{{ url_for('static',path = '/images/logo.png')}}"alt="manage" width="30px" height="30px">
                                    </div>
                                </div>
                                <div class = "row">
                                    <div class="message-container-2">
                                        <img src="{{ url_for('static', path ='/images/good.png')}}" alt="good" width="30px" height="30px">
                                        <div class="user-message">새우가 없는 짬뽕이요</div>
                                    </div>
                                </div>
                                <div class = "row">
                                    <div class="message-container-1">
                                        <div class="bot-message">근처 OOO 가게의 홍합짬뽕을 시켜드릴까요?</div>
                                        <img src="{{ url_for('static',path = '/images/logo.png')}}" alt="manage" width="30px" height="30px">
                                    </div>
                                </div>
                                <div class = "row">
                                    <div class="message-container-2">
                                        <img src="{{ url_for('static', path ='/images/good.png')}}" alt="good" width="30px" height="30px">
                                        <div class="user-message">네</div>
                                    </div>
                                </div>
                                <div class = "row">
                                    <div class="message-container-1">
                                        <div class="bot-message">주소가 어떻게 되나요?</div>
                                        <img src="{{ url_for('static',path = '/images/logo.png')}}" alt="manage" width="30px" height="30px">
                                    </div>
                                </div>
                                <div class = "row">
                                    <div class="message-container-2">
                                        <img src="{{ url_for('static', path ='/images/good.png')}}" alt="good" width="30px" height="30px">
                                        <div class="user-message">OOO 동 OOO 아파트 DD동 HHH호요</div>
                                    </div>
                                </div>
                                <div class = "row">
                                    <div class="message-container-1">
                                        <div class="bot-message">주문해드렸습니다.</div>
                                        <img src="{{ url_for('static',path = '/images/logo.png')}}" alt="manage" width="30px" height="30px">
                                    </div>
                                    <div id = text>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer text-muted d-flex justify-content-start align-items-center p-3" style="background-color: lightgoldenrodyellow;">
                        <div class="d-flex flex-row justify-content-start">
                            <div class ="chat-container-2">
                                <input type="text" id="user-input" placeholder="메시지를 입력하세용...">
                                <button id =toyou ><img src="{{ url_for('static',path = 'images/send.png')}}"  alt = "send" width="30px" height="30px"></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

   


</body>
<footer>
 <script>
            // 버튼 클릭 이벤트 처리
            $("#toyou").click(function () {
                // 입력된 데이터 가져오기
                
                let inputData = $("#user-input").val();  // data-input의 값만 가져오기
                if (inputData !== '') {
                // text라는 ID를 가진 요소를 text 변수에 저장
                //let text = $("#chat-container");
                let text = $("#text");
                let result = $(".user-message");
                

                // 새로운 <p> 태그를 동적으로 생성하여 text 요소에 추가
                text.append('<div>'+"<div class='message-container-2'>"+
                                "<div class='user-message'>"+ "<p>" + inputData + "<br>"+"</p>"+"</div>"+"<img src=\"{{ url_for('static',path = '/images/good.png')}}\" alt=\"manage\" width=\"30px\" height=\"30px\">" +"</div>" );

                // fastapi의 BaseModel은 JSON 형식을 받는데 그냥 data로 보내면 오류남
                // contentType으로 JSON임을 알려주고 JSON.stringify로 데이터를 JSON으로 변환
                
                $.ajax({
                    type: "post", // 어떤 방식으로 보낼지
                    url: "http://127.0.0.1:8000/dobot.html",  // 보낼 주소 (여기에는 엔드포인트만 필요합니다)
                    contentType: "application/json",  // 서버에 JSON 형식임을 알려줌
                    data: JSON.stringify({ data: inputData }),  // 데이터를 JSON 문자열로 변환

                    // 성공적인 전송시 서버에서 반환된 response 받음
                    success: function (response) {
                        // 서버 응답을 성공하면 실행
                         text.append('<div>'+"<div class='message-container-1'>"+
                                "<div class='bot-message'>"+"<P>" +response.processed_data+"<br>"+"</div>"+"<img src=\"{{ url_for('static',path = '/images/logo.png')}}\" alt=\"manage\" width=\"30px\" height=\"30px\">"+"</div>" +"</div>");
                         
                            },

                    // 현재 입력된 요소에 입력된 요소를 계속 더하기, <br>은 줄바꿈
                    error: function () {
                        alert("실패");
                    }
                });
                

                $("#user-input").val('');  // 값을 입력 필드로 바꾸기
                 } 
            });
        </script>
    


</footer>


</html>